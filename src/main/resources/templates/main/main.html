<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" style="overflow: hidden; margin: 0;">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Kiosk Home</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">

    <!-- CSS for DetailModal -->
    <link th:href="@{/kiosk/css/mainDetailModal.css}"
          href="../kiosk/css/mainDetailModal.css" rel="stylesheet">

    <!-- CSS for OrderModal -->
    <link th:href="@{/kiosk/css/mainOrderModal.css}"
          href="../kiosk/css/mainOrderModal.css" rel="stylesheet">

    <!-- CSS for Main -->
    <link th:href="@{/kiosk/css/main.css}"
          href="../kiosk/css/main.css" rel="stylesheet">
</head>
<body>
<!-- 1175 x 740px -->
<div class="main-contain">
    <div class="modal-bg">
    </div>
    <div class="left-side">
        <form th:action="@{/cart/delete}" th:method="post">
            <button id="back-btn" class="back-btn btn btn-primary" type="submit">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-return-left" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5"/>
                </svg>
            </button>
        </form>
        <button class="side-menu-btn set-btn btn btn-primary" type="button">
            <span th:text="#{set.menu}">세트</span>
        </button>
        <button class="side-menu-btn single-btn btn btn-primary" type="button">
            <span th:text="#{single.menu}">단품</span>
        </button>
        <button class="side-menu-btn drink-btn btn btn-primary" type="button">
            <span th:text="#{drink.menu}">음료</span>
        </button>
    </div>

    <div class="item-list-main">
        <!-- Set Menu -->
        <div class="title set-title">
            <hr class="title-hr-first hr-2">
            <span class="title-text" th:text="#{set.menu}">세트</span>
            <hr class="title-hr-last hr-2">
        </div>

        <div id="b-set" class="menu-card card" style="width: 18rem;">
            <img src="/kiosk/img/mainitemlist/beef_set.png" class="card-img-top" alt="MenuImage">
            <div class="menu-card-texts card-body">
                <h5 class="menu-name card-title" th:text="#{beef.taco.set}">소고기 타코 세트</h5>
                <p class="menu-info card-text" th:text="#{beef.taco.info}">소고기 타코 단품 + 음료 택 1</p>
                <p class="menu-price card-text" th:text="#{beef.taco.price}">12,000원</p>
            </div>
        </div>

        <div id="s-set" class="menu-card card" style="width: 18rem;">
            <img src="/kiosk/img/mainitemlist/sausage_set.png" class="card-img-top" alt="MenuImage">
            <div class="menu-card-texts card-body">
                <h5 class="menu-name card-title" th:text="#{sausage.taco.set}">소시지 타코 세트</h5>
                <p class="menu-info card-text" th:text="#{sausage.taco.info}">소시지 타코 단품 + 음료 택 1</p>
                <p class="menu-price card-text" th:text="#{sausage.taco.price}">10,000원</p>
            </div>
        </div>

        <!-- Single Menu -->
        <div class="title single-title">
            <hr class="title-hr-first hr-2">
            <span class="title-text" th:text="#{single.menu}">단품</span>
            <hr class="title-hr-last hr-2">
        </div>

        <div id="b-single" class="menu-card card" style="width: 18rem;">
            <img src="/kiosk/img/mainitemlist/beef_single.png" class="card-img-top" alt="MenuImage">
            <div class="menu-card-texts card-body">
                <h5 class="menu-name card-title" th:text="#{beef.taco.single}">소고기 타코 단품</h5>
                <p class="menu-info card-text" th:text="#{beef.taco.single.info}">"신선한 소고기와 풍부한 향신료가 어우러진, 매력적인 멕시코식 타코입니다."</p>
                <p class="menu-price card-text" th:text="#{beef.taco.single.price}">10,000원</p>
            </div>
        </div>

        <div id="s-single" class="menu-card card" style="width: 18rem;">
            <img src="/kiosk/img/mainitemlist/sausage_single.png" class="card-img-top" alt="MenuImage">
            <div class="menu-card-texts card-body">
                <h5 class="menu-name card-title" th:text="#{sausage.taco.single}">소시지 타코 단품</h5>
                <p class="menu-info card-text" th:text="#{sausage.taco.single.info}">"육즙 가득한 소시지와 신선한 채소가 어우러진, 풍미 가득 멕시코식 타코입니다."</p>
                <p class="menu-price card-text" th:text="#{sausage.taco.single.price}">8,000원</p>
            </div>
        </div>

        <!-- Drink Menu -->
        <div class="title drink-title">
            <hr class="title-hr-first hr-2">
            <span class="title-text" th:text="#{drink.menu}">음료</span>
            <hr class="title-hr-last hr-2">
        </div>

        <div id="coke" class="menu-card card" style="width: 18rem;">
            <img src="/kiosk/img/mainitemlist/drink_coke.png" class="card-img-top" alt="MenuImage">
            <div class="menu-card-texts card-body">
                <h5 class="menu-name card-title" th:text="#{coke}">콜라</h5>
                <p class="menu-info card-text" th:text="#{coke.info}">"달콤한 맛의 대표, 코카콜라."</p>
                <p class="menu-price card-text" th:text="#{coke.price}">2,000원</p>
            </div>
        </div>

        <div id="sprite" class="menu-card card" style="width: 18rem;">
            <img src="/kiosk/img/mainitemlist/drink_cider.png" class="card-img-top" alt="MenuImage">
            <div class="menu-card-texts card-body">
                <h5 class="menu-name card-title" th:text="#{cider}">사이다</h5>
                <p class="menu-info card-text" th:text="#{cider.info}">"톡 쏘는 청량감의 칠성사이다."</p>
                <p class="menu-price card-text" th:text="#{cider.price}">2,000원</p>
            </div>
        </div>

        <div style="padding-top: 5vh"></div>

        <!-- Product Detail Modal -->
        <input type="checkbox" id="modal-detail" />
        <div class="modal-bg-detail"></div>
        <div class="modal-content-detail">
            <label for="modal-detail" class="close">
                <i class="fa fa-times" aria-hidden="true"></i>
            </label>

            <input type="hidden" name="productId" />
            <header>
                <p>메뉴 이름</p>
                <button class="modal-close-btn" type="button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
                    </svg>
                </button>
            </header>

            <div class="content-detail">
                <div class="modal-info-detail">
                    <div class="image-wrapper">
                        <img src="/kiosk/img/mainitemlist/beef_single.png" alt="DetailImage">
                    </div>
                    <div class="detail-text">
                        <p id="detail-explain">신선한 소고기와 다채로운 야채가 어우러진 풍성한 타코 세트. 음료 선택 포함.</p>
                        <p id="detail-price">가격 : 12,000원</p>
                    </div>
                </div>

                <div class="modal-row-done detail-block">
                    <h4 class="option-head" th:text="#{cooking.option}">굽기 옵션</h4>
                    <div class="block raw-block">
                        <input type="checkbox" id="rare" class="block-checkbox">
                        <label for="rare">
                            <img src="/kiosk/img/productdetail/rare_resize.png" alt="RareImage">
                            <span th:text="#{rare}">레어 (40%)</span>
                        </label>
                    </div>
                    <div class="block medium-block">
                        <input type="checkbox" id="medium" class="block-checkbox">
                        <label for="medium">
                            <img src="/kiosk/img/productdetail/medium_resize.png" alt="MediumImage">
                            <span th:text="#{medium}">미디움 (70%)</span>
                        </label>
                    </div>
                    <div class="block well-block">
                        <input type="checkbox" id="well" class="block-checkbox">
                        <label for="well">
                            <img src="/kiosk/img/productdetail/well_resize.png" alt="WellImage">
                            <span th:text="#{well.done}">웰던 (100%)</span>
                        </label>
                    </div>
                </div>

                <div class="modal-row-salad detail-block">
                    <h4 class="option-head" th:text="#{vegetable.option}">야채 옵션</h4>
                    <div class="block corn-block">
                        <input type="checkbox" id="corn" class="block-checkbox">
                        <label for="corn">
                            <img src="/kiosk/img/productdetail/corn_resize.png" alt="CornImage">
                            <span th:text="#{corn.less}">콘 적게</span>
                        </label>
                    </div>
                    <div class="block lettuce-block">
                        <input type="checkbox" id="lettuce" class="block-checkbox">
                        <label for="lettuce">
                            <img src="/kiosk/img/productdetail/lettuce_resize.png" alt="LettuceImage">
                            <span th:text="#{lettuce.less}">양상추 적게</span>
                        </label>
                    </div>
                    <div class="block olive-block">
                        <input type="checkbox" id="olive" class="block-checkbox">
                        <label for="olive">
                            <img src="/kiosk/img/productdetail/olive_resize.png" alt="OliveImage">
                            <span th:text="#{olive.less}">올리브 적게</span>
                        </label>
                    </div>
                </div>

                <div class="modal-row-drink detail-block">
                    <h4 class="option-head" th:text="#{drink.option}">음료 옵션</h4>
                    <div class="block coke-block">
                        <input type="checkbox" id="coke-image" class="block-checkbox">
                        <label for="coke-image">
                            <img src="/kiosk/img/productdetail/coke_resize.png" alt="CokeImage">
                            <span th:text="#{coke}">콜라</span>
                        </label>
                    </div>
                    <div class="block cider-block">
                        <input type="checkbox" id="cider" class="block-checkbox">
                        <label for="cider">
                            <img src="/kiosk/img/productdetail/cider_resize.png" alt="CiderImage">
                            <span th:text="#{cider}">사이다</span>
                        </label>
                    </div>
                </div>
            </div>

            <footer>
                <label for="modal-detail" class="button danger" th:text="#{cancel}">취소</label>
                <label for="modal-detail" class="button success" id="add-button" th:text="#{add}">추가</label>
            </footer>
        </div>
    </div>

    <div class="cart-footer">
        <div id="cart-items-container">
            <div th:if="${cart == null or #lists.isEmpty(cart.items)}">
                <p style="text-align: center; font-size: 24px; color: white; padding-top: 25%;" th:text="#{cart.empty}">장바구니가 비어 있습니다.</p>
            </div>
            <div th:unless="${cart == null or #lists.isEmpty(cart.items)}">
                <div th:each="product : ${cart.items}">
                    <div class="preview-cart-items">
                        <button class="delete-btn" th:data-product-id="${product.id}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle-fill" viewBox="0 0 16 16">
                                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293z"/>
                            </svg>
                        </button>
                        <div class="item-name-price">
                            <div class="preview-item-name" th:text="${product.productName}"></div>
                            <div class="preview-item-price" th:text="${product.price + '원'}"></div>
                        </div>
                        <div class="item-quantity-ctrl">
                            <button type="button" class="plus-btn btn btn-danger" th:data-product-id="${product.id}">+</button>
                            <span class="item-quantity" th:data-product-id="${product.id}" th:text="${product.quantity}"></span>
                            <button type="button" class="minus-btn btn btn-danger" th:data-product-id="${product.id}">-</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="cart-summary" class="order-footer">
        <div class="total-price">
            <span class="total-price-text" th:text="#{total.price}">총 가격</span>
            <span id="total-price-result" class="total-price-result" th:text="${totalPrice} + '원'"></span>
        </div>
        <div class="total-quantity">
            <span class="total-quantity-text" th:text="#{total.quantity}">총 수량</span>
            <span id="total-quantity-result" class="total-quantity-result" th:text="${totalQuantity}"></span>
        </div>
        <div class="order-area">
            <button class="order-btn btn btn-primary" id="order-btn" type="button"
                    data-bs-toggle="modal" data-bs-target="#orderModal" th:text="#{order}">
                주문하기
            </button>
        </div>

        <!-- Order Modal -->
        <div class="modal fade" id="orderModal" tabindex="-1" aria-labelledby="orderModalLabel" aria-hidden="true">
            <div class="modal-dialog order-dialog">
                <form th:action="@{/order/submit}" method="post" id="orderForm">
                    <div class="modal-content modal-content-order">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="orderModalLabel" th:text="#{cart}">장바구니</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="modal-order-list">
                                <ul class="list-group">
                                    <li class="list-group-item list-title" style="background-color: #d2dfee" th:text="#{order.list}">주문 목록</li>
                                    <!-- 장바구니 상품 목록 반복 -->
                                    <li th:each="product, iterStat : ${cart.items}" class="list-group-item list-row">
                                        <!-- 상품 정보를 히든 필드로 전달 -->
                                        <input type="hidden" name="products[__${iterStat.index}__].id" th:value="${product.id}">
                                        <input type="hidden" name="products[__${iterStat.index}__].productName" th:value="${product.productName}">
                                        <input type="hidden" name="products[__${iterStat.index}__].price" th:value="${product.price}">
                                        <input type="hidden" name="products[__${iterStat.index}__].quantity" th:value="${product.quantity}">
                                        <!-- 옵션은 필요에 따라 추가 구현 -->
                                        <div class="order-list-name">
                                            <span th:text="${product.productName}">상품명</span>
                                        </div>
                                        <div class="order-list-quantity">
                                            <span class="list-row-quantity" th:text="${product.quantity + '개'}">수량</span>
                                        </div>
<!--                                        <div class="order-list-options">-->
<!--                                            <span th:each="key : ${product.options.keySet()}"-->
<!--                                                  th:text="${key} + ' : ' + ${product.options[key]}">옵션</span>-->
<!--                                        </div>-->
                                        <div class="order-list-options">
                                            <span th:each="entry : ${product.options.entrySet()}">
<!--                                                <span th:text="${entry.key} + ' : '"></span>-->
                                                <span th:if="${entry.value instanceof T(java.util.List)}">
                                                    <span th:each="val : ${entry.value}" th:text="${val + ' '}"></span>
                                                </span>
                                                <span th:unless="${entry.value instanceof T(java.util.List)}" th:text="${entry.value}"></span>
                                            </span>
                                        </div>
                                        <div class="order-list-price">
                                            <span th:text="${(product.price * product.quantity) + '원'}">가격</span>
                                        </div>
                                    </li>
                                </ul>
                            </div>

                            <div class="modal-order-options">
                                <div class="modal-takeout order-block" id="diningOptionGroup">
                                    <div class="block takeout-block">
                                        <input type="radio" id="takeout" name="diningOption" value="takeout" class="block-checkbox">
                                        <label for="takeout">
                                            <span th:text="#{takeout.option}">포장하기</span>
                                        </label>
                                    </div>
                                    <div class="block hall-block" id="paymentMethodGroup">
                                        <input type="radio" id="hall" name="diningOption" value="hall" class="block-checkbox">
                                        <label for="hall">
                                            <span th:text="#{dine.in}">매장식사</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="modal-pay order-block">
                                    <div class="block cash-block">
                                        <input type="radio" id="pay-cash" name="paymentMethod" value="cash" class="block-checkbox">
                                        <label for="pay-cash">
                                            <span th:text="#{pay.cash}">현금 결제</span>
                                        </label>
                                    </div>
                                    <div class="block credit-block">
                                        <input type="radio" id="pay-credit" name="paymentMethod" value="credit" class="block-checkbox">
                                        <label for="pay-credit">
                                            <span th:text="#{pay.card}">카드 결제</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="modal-receipt order-block">
                                    <div class="block receipt-block">
                                        <input type="checkbox" id="receipt" name="receipt" class="block-checkbox">
                                        <label for="receipt">
                                            <span th:text="#{print.receipt}">영수증 출력</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <div>
                                <div class="bd-callout bd-callout-info">
                                    <h5 th:text="#{total.payment.amount} + ' : ' + ${totalPrice + '원'}">총 결제 금액 : 0원</h5>
                                </div>
                            </div>
                            <div>
                                <button type="button" class="btn btn-secondary modal-btn-order close-btn-order"
                                        data-bs-dismiss="modal" th:text="#{cancel}">취소</button>
                                <button type="submit" class="btn btn-primary modal-btn-order confirm-btn-order"
                                        data-bs-target="#staticBackdrop"
                                        data-bs-toggle="modal" th:text="#{pay}">결제</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- QR Modal -->
        <div class="modal fade" id="staticBackdrop" aria-hidden="true" aria-labelledby="staticBackdropLabel"
             tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header" style="display: flex; justify-content: center">
                        <div class="spinner-border text-primary" role="status" style="margin-right: 15px;">
                            <span class="visually-hidden" th:text="#{loading}">Loading...</span>
                        </div>
                        <h1 class="modal-title fs-5" id="staticBackdropLabel" th:text="#{waiting.approval}">
                            승인 대기 중...
                        </h1>
                    </div>
                    <div class="modal-body" style="display: flex; justify-content: center; overflow: hidden;">
                        <div style="width: 300px; height: 300px; display: flex; justify-content: center; flex-direction: column;">
                            <img src="/kiosk/img/qrmodal/qrcode.png" alt="QRImage" style="object-fit: cover; max-width: inherit; max-height: inherit; height: inherit; width: inherit;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button id="ai-start-btn" class="ai-side">
        <img class="chat-bot-logo" src="/kiosk/img/aichat/chatbot_logo_vector.png" alt="chat-bot-logo" style="padding-bottom: 50px">
        <span class="ai-start-btn-text"
              style="padding-bottom: 50px; font-size: xx-large; color: black"
              th:text="#{ask.anything}">무엇이든 물어보세요</span>
        <span class="ai-start-btn-text-2"
              style="font-size: x-large; color: black"
              th:text="#{click.to.start}">클릭하여 시작하기</span>
    </button>
</div>

<!-- Start AI Chat : Hidden <div> -->
<div id="ai-chat-div" style="display: none;">
    <div class="ai-side-after">
        <div class="messages-area">
            <div class="message">
                <p class="from-ai margin-t_one" style="margin-top: 10px" th:text="#{ai.greeting}">
                    안녕하세요 무엇을 도와드릴까요?
                    하단의 질문하기 버튼을 누르고 말씀해주세요.
                    빨간 정지 버튼을 누르면 음성 인식이 중지됩니다.
                </p>
            </div>
        </div>
        <div class="ai-side-footer">
            <div class="ai-mic">
                <div class="buttons">
                    <button id="startButton-ai" class="btn-hover color-3"
                            th:text="#{ask.question}">질문하기</button>
                    <img class="ai-mic-logo" src="/kiosk/img/aichat/whitemic_logo_vector.png" alt="mic-logo">
                </div>
            </div>

            <div class="admin-mic">
                <div class="buttons">
                    <button id="startButton-admin" class="btn-hover color-10"
                            th:text="#{connect.staff}">직원 연결</button>
                    <img class="admin-mic-logo" src="/kiosk/img/aichat/agent_logo_vector.png" alt="agent-logo">
                </div>
            </div>

            <div class="stop-and-send">
                <label for="status-and-text"></label>
                <textarea id="status-and-text" class="alert alert-secondary"
                          th:placeholder="#{recorded.text.placeholder}" rows="3" required>
                </textarea>

                <button id="stopButton" class="btn btn-danger" type="button" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-stop-circle-fill" viewBox="0 0 16 16">
                        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M6.5 5A1.5 1.5 0 0 0 5 6.5v3A1.5 1.5 0 0 0 6.5 11h3A1.5 1.5 0 0 0 11 9.5v-3A1.5 1.5 0 0 0 9.5 5z"/>
                    </svg>
                </button>
                <button id="sendButton" class="btn btn-primary" type="button" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-send-fill" viewBox="0 0 16 16">
                        <path d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!--AI Chat : Recorder, AudioControl, ChatBubbleConversion, GPTWhisper, GPT4o, StartPaging-->
<script src="/kiosk/js/aiChat.js"></script>
<!-- Product Detail/Order Modal -->
<script src="/kiosk/js/mainModals.js"></script>
<!-- Cart Item Control -->
<script src="/kiosk/js/mainFooter.js"></script>

<!-- 모달 자동 열기 스크립트 추가 -->
<script th:inline="javascript">
    /* 모달 자동 열기 */
    [[${orderError}]] ? openOrderModalWithErrors() : null;
    [[${orderSuccess}]] ? showQRModal() : null;
</script>

</body>
</html>